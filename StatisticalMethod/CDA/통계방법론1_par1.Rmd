---
title: "통계 방법론1 part1"
author: "응용통계학과 이준혁"
date: "2023-10-14(토)"
output:
  html_document:
    css: styles.css
    #code_folding: show
    fig_caption: yes
    fig_height: 7.5
    fig_width: 10
    fig_retina: null
    highlight: haddock
    self_contained: yes
    theme: cosmo
    toc: yes
    toc_depth: 6
    toc_float: yes
    fig_dpi: 300
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<style type="text/css">
  body, td {
     font-size: 16px;
     font-family: 맑은 고딕
  }
  code.r{
    font-size: 16px;
    font-weight: bold;
    font-family: 맑은 고딕
  }
  pre {
    font-size: 14px
    font-family: 맑은 고딕
  }
  h1,h2,h3,h4,h5,h6{
    font-family: 맑은 고딕;
    font-weight: bold;
  }
  h1{
    font-size: 18pt;
  }
  h2{
    font-size: 16pt;
  }
  h3{
    font-size: 14pt;
  }
  table{
    font-size: 20px;
  }
</style>
<br><br><br><br>

---

# Part1, 단순 회귀 분석 Simple Regression Analysis

## 예제1. simple.csv: 임의로 선택된 소형 화물의 무게$(x;~g)$과 부피$(y;~cm^3)$

-   무게에 의하여 운송 요금을 결정하는 소형 화물들 중에서 임의로 선택된 58개의 무게(x; weight)과 부피(y; volume)을 조사하였다.
-   이를 이용하여 중량과 부피간의 관계를 추정하여 운송 계획을 수립하고자 한다.

```{r}
cargo <- read.csv(paste0(data_path, "simple.csv"))
str(cargo)

na_count <- function(df){
  sapply(df, function(y) sum(length(which(is.na(y)))))
}

na_count(cargo)
x <- cargo$x
y <- cargo$y
Sxy <- sum((x - mean(x)) * (y - mean(y)))
Sxx <- sum((x - mean(x))^2)
Syy <- sum((y - mean(y))^2)
#
hat_beta1 <- Sxy / Sxx
hat_beta0 <- mean(y) - hat_beta1*mean(x)
round(c(hat_beta0, hat_beta1), 2)


```

## 실습 18. 유통 매장 정리 시간 dist.store.csv

```{r}
dist <- read.csv(paste0(data_path, "dist.store.csv"))

```

```{r}
str(dist)
head(dist)
tail(dist)
view(dist)
```

```{r}
dist <- dist %>% 
  rename_all(tolower)

head(dist, 5)
```
```{r}
na_count <- function(df){
  sapply(df, function(y) sum(length(which(is.na(y)))))
}

na_count(dist)
```

-   (case, time)의 관계는 직선의 경향을 갖는다.

```{r}
dist %>% 
  ggplot(aes(case, time)) +
  geom_point(color = sbl) +
  theme_bw()
```

```{r}
dest_fit <- lm(time ~ case, data = dist)
```


# Part1, 다중 회귀 분석 Multiple Regression Analysis

## C-materials cem.materials.csv

```{r}
cem <- read.csv(paste0(data_path,"cem.materials.csv"))
str(cem)
```
-   변수 이름과 위치 정리

```{r}
cem <- cem %>% 
  dplyr::rename_all(tolower) %>% 
  select(-id) %>% 
  relocate(y)
```
-   결측값 확인

```{r}
na_count <- function(data){
  sapply(data, function(y) sum(length(which(is.na(y)))))
}
```

-   데이터 시각화: 행렬도(matrix plot)

```{r}
cem %>% 
  ggpairs(columns = 1:ncol(.),
          lower = list(continuous = wrap("points", # continuous = "smooth"
                                         color = sbl,
                                         aplha = 0.5)
                   ),
          upper = list(continuous = wrap("points", # wrap("cor", size = 2.5)
                                         color = sbl,
                                         alpha =0.5)
                   ),
          diag = list(continuous = wrap("densityDiag",
                                        color = "black",
                                        alpha = 0.5)
                   ),
          title = "Component Data") +
  theme_bw()
```

-   함수 정의
    -   원하는 형태의 행렬도(matrix plot) 형식을 결정하여 함수화
    
```{r}
gg_mplot <- function(df, ttl){
  df %>% 
  ggpairs(columns = 1:ncol(.),
          lower = list(continuous = wrap("points", #continuous = "smooth"
                                         color = sbl,
                                         alpha = 0.5)
                       ),
          upper = list(continuous = wrap("points", #wrap("cor", size = 2.5)
                                         color = sbl,
                                         alpha = 0.5)
                       ),
          diag = list(continuous = wrap("densityDiag",
                                        color = "black",
                                        alpha = 0.5)
                       ),
          title = ttl) +
  theme_bw()
}

ttl = "Component Data: function 활용"
gg_mplot(cem, ttl)
```


-   다중 회귀 분석: lm()
    -   lm() 함수는 단순 회귀 분석과 동일하게 적용된다.
    -   단, formula를 사전에 지정하는 경우에는 문자형으로 정의되어야 한다.

```{r}
fml <- "y ~ t1 + t2 + t3 + t4"
cem_model <- lm(fml, cem)
summary(cem_model)
```
-   구간 추정
    -   lm()에 의한 model object가 생성
    

```{r}
confint(cem_model, level = 0.95)
```

```{r}
confint(cem_model, c("t1", "t2"), level = 0.95)
```

-   가설 검정
    -   lm()을 적용한 model object의 summary()의 coef를 부분 선택
  
```{r}
summary(cem_model)$coef
```




