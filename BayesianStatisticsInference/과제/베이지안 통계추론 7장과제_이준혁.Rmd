---
title: "베이지안 통계추론 7장 과제"
author: "응용통계학과 이준혁"
date: "2023-10-27"
output:
  html_document:
    css: styles.css
    #code_folding: show
    fig_caption: yes
    fig_height: 7.5
    fig_width: 10
    fig_retina: null
    highlight: haddock
    self_contained: yes
    theme: cosmo
    toc: yes
    toc_depth: 6
    toc_float: yes
    fig_dpi: 300
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<style type="text/css">
  body, td {
     font-size: 16px;
     font-family: 맑은 고딕
  }
  code.r{
    font-size: 16px;
    font-weight: bold;
    font-family: 맑은 고딕
  }
  pre {
    font-size: 14px
    font-family: 맑은 고딕
  }
  h1,h2,h3,h4,h5,h6{
    font-family: 맑은 고딕;
    font-weight: bold;
  }
  h1{
    font-size: 18pt;
  }
  h2{
    font-size: 16pt;
  }
  h3{
    font-size: 14pt;
  }
</style>

---
```{r}
library(ggplot2)

```
# 1번 문제

```{r}
# prior
mu0 = 100; sig0 = 5; n = 10; xbar = 110; s = sqrt(10/n)

# posterior
c= n/s^2 ; c0=1/sig0^2; w = c/(c+c0)
mu.post = w * xbar + (1-w)* mu0; sig.post = sqrt( 1/(c+c0) )

theta=seq(mu.post-5*sig.post, mu.post+5*sig.post, length=100)

plot(theta, dnorm(theta,mu.post, sig.post), type="l",main="posterior and prior of theta")
legend("topright",legend="posterior",lty=c(1),bty="n")
```

# $\theta의 사후 분포$

```{r}
mu.post
sig.post
```



# 2번 문제

2-(1)

```{r}
# prior
mu0 = 150; sig0 = sqrt(21); n = 20; xbar = 150; s = sqrt(21/n)

# posterior
c= n/s^2 ; c0=1/sig0^2; w = c/(c+c0)
mu.post = w * xbar + (1-w)* mu0; sig.post = sqrt( 1/(c+c0) )

theta=seq(mu.post-5*sig.post, mu.post+5*sig.post, length=100)
ftheta = dnorm(theta, mu.post, sig.post)
prob = ftheta/sum(ftheta)

HPDgrid <- function(prob,level=0.95){
  prob.sort=sort(prob,decreasing = T)
  M=min(which(cumsum(prob.sort)>=level))
  height=prob.sort[M]
  HPD.index=which(prob>=height)
  HPD.level=sum(prob[HPD.index])
  res=list(index=HPD.index, level=HPD.level)
  return(res)
}

HPD <- HPDgrid(prob, 0.95)

HPD.grid=c( min(theta[HPD$index]), max(theta[HPD$index]) )
HPD.grid  


# Plotting only the posterior distribution
plot(theta, dnorm(theta,mu.post, sig.post), type="l",main="Posterior of theta", ylab="Density")
abline(v=HPD.grid, lty=2, col="red")

legend("topright",legend="posterior",lty=c(1),bty="n")

```

```{r}
mu.post
sig.post
```

```{r}
df <- data.frame(
  theta = theta, 
  density = dnorm(theta, mu.post, sig.post)
)

# ggplot 그래프 생성
g1 <- ggplot(df, aes(x=theta, y=density)) +
  geom_line(colour="black", aes(y = dnorm(theta, mu.post, sig.post))) +
  geom_vline(aes(xintercept=HPD.grid[1]), linetype="dashed", color="red") +
  geom_vline(aes(xintercept=HPD.grid[2]), linetype="dashed", color="red") +
  labs(title="Posterior of theta", y="Density", x="theta") +
  theme_minimal() +
  annotate("text", x=max(theta) - 0.3, y=max(density)-0.1, label="posterior")

print(g1)
```


2-(2)

```{r}
# No prior information: setting a vague prior
n = 20; xbar = 150; s = sqrt(21/n)

# posterior calculation remains the same
mu.post_2 = xbar; sig.post_2 = sqrt(21/n)

theta_2=seq(mu.post_2-5*sig.post_2, mu.post_2+5*sig.post_2, length=100)
ftheta = dnorm(theta_2, mu.post_2, sig.post_2)
prob = ftheta/sum(ftheta)

HPD <- HPDgrid(prob, 0.95)

HPD.grid_2=c( min(theta_2[HPD$index]), max(theta_2[HPD$index]) )
HPD.grid_2 
# Plotting only the posterior distribution

plot(theta_2, dnorm(theta_2,mu.post_2, sig.post_2), type="l",main="Posterior of theta", ylab="Density")
abline(v=HPD.grid_2, lty=2, col="red")
legend("topright",legend="posterior",lty=c(1),bty="n")

```

```{r}
# 데이터 프레임 생성
df <- data.frame(
  theta = c(theta_2, theta_2), 
  density = c(dnorm(theta_2, mu.post_2, sig.post_2), rep(NA, length(theta_2)))
)

# ggplot 그래프 생성
g2 <- ggplot(df, aes(x=theta, y=density)) +
  geom_line(aes(y = dnorm(theta, mu.post_2, sig.post_2)), colour="black") +
  geom_vline(aes(xintercept=HPD.grid_2[1]), linetype="dashed", color="red") +
  geom_vline(aes(xintercept=HPD.grid_2[2]), linetype="dashed", color="red") +
  labs(title="Posterior of theta", y="Density", x="theta_2") +
  theme_minimal()

print(g2)
```


```{r}
mu.post_2
sig.post_2
```

2-(3)

```{r}

```


2-(4)

# prior
mu0 = 150; sig0 = sqrt(21); n = 20; xbar = 150; s = sqrt(21/n)

# posterior
c= n/s^2 ; c0=1/sig0^2; w = c/(c+c0)
mu.post = w * xbar + (1-w)* mu0; sig.post = sqrt( 1/(c+c0) )
theta=seq(mu.post-5*sig.post, mu.post+5*sig.post, length=100)

```{r}
#predictive
mu.new = mu.post; sig.new = sqrt( s^2 + sig.post^2 )
xnew=seq(mu.new - 5* sig.new , mu.new + 5* sig.new, length=100)

plot(xnew, dnorm(xnew, mu.new, sig.new),type="l", main="Predictivedensity of X_new")

prob = pnorm(153, mu.new, sig.new) - pnorm(150, mu.new, sig.new)
prob


```

# 3번 문제

```{r}

```


# 4번 문제

```{r}

```



# 5번 문제

```{r}

#library(msm)
theta <- seq(0, 1.5, length=1000)
plot(theta, dnorm(theta, 0.33, sqrt(1/20), lower=0, upper=inf))
```





